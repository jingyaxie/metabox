# MetaBox å¼€å‘æŒ‡å—

æ¬¢è¿æ¥åˆ° MetaBox å¼€å‘æŒ‡å—ï¼æœ¬æ–‡æ¡£å°†å¸®åŠ©æ‚¨å¿«é€Ÿæ­å»ºå¼€å‘ç¯å¢ƒï¼Œäº†è§£é¡¹ç›®æ¶æ„ï¼Œå¹¶å¼€å§‹å¼€å‘å·¥ä½œã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- **Python**: 3.8+
- **Node.js**: 16+
- **Git**: æœ€æ–°ç‰ˆæœ¬
- **Docker**: 20.10+ (å¯é€‰)
- **Docker Compose**: 2.0+ (å¯é€‰)

### å¼€å‘ç¯å¢ƒæ­å»º

#### 1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/your-repo/metabox.git
cd metabox
```

#### 2. åç«¯ç¯å¢ƒé…ç½®
```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate  # macOS/Linux
# æˆ–
venv\Scripts\activate.bat  # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
pip install -r requirements-dev.txt

# è®¾ç½®ç¯å¢ƒå˜é‡
cp ../env.example ../.env
# ç¼–è¾‘ .env æ–‡ä»¶é…ç½®æ•°æ®åº“è¿æ¥ç­‰ä¿¡æ¯
```

#### 3. å‰ç«¯ç¯å¢ƒé…ç½®
```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd frontend

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

#### 4. æ•°æ®åº“æœåŠ¡
```bash
# å¯åŠ¨æ•°æ®åº“æœåŠ¡
docker-compose up -d postgres redis qdrant

# åˆå§‹åŒ–æ•°æ®åº“
cd backend
python -m alembic upgrade head
```

#### 5. å¯åŠ¨åç«¯æœåŠ¡
```bash
# åœ¨backendç›®å½•ä¸‹
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### æ•´ä½“æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   React å‰ç«¯    â”‚ TypeScript + Tailwind + Zustand
â”‚                 â”‚ - ç°ä»£åŒ–UIç»„ä»¶åº“
â”‚                 â”‚ - å“åº”å¼è®¾è®¡
â”‚                 â”‚ - çŠ¶æ€ç®¡ç†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FastAPI åç«¯  â”‚ Python + SQLAlchemy + Pydantic
â”‚                 â”‚ - RESTful APIè®¾è®¡
â”‚                 â”‚ - å¼‚æ­¥å¤„ç†
â”‚                 â”‚ - æ•°æ®éªŒè¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Qdrant  â”‚PostgreSQLâ”‚ Redis â”‚ æ•°æ®å­˜å‚¨
â”‚ å‘é‡åº“  â”‚ç»“æ„åŒ–æ•°æ®â”‚ ç¼“å­˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‰ç«¯æ¶æ„
```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/       # å¯å¤ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ chat/        # èŠå¤©ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ui/          # åŸºç¡€UIç»„ä»¶
â”‚   â”‚   â””â”€â”€ common/      # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ pages/           # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Home.tsx     # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ Chat.tsx     # èŠå¤©é¡µé¢
â”‚   â”‚   â”œâ”€â”€ KnowledgeBase.tsx # çŸ¥è¯†åº“é¡µé¢
â”‚   â”‚   â”œâ”€â”€ AdminDashboard.tsx # ç®¡ç†å‘˜ä»ªè¡¨æ¿
â”‚   â”‚   â””â”€â”€ Settings.tsx # è®¾ç½®é¡µé¢
â”‚   â”œâ”€â”€ hooks/           # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â”œâ”€â”€ useAuth.ts   # è®¤è¯ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ useChat.ts   # èŠå¤©ç›¸å…³
â”‚   â”‚   â””â”€â”€ useKB.ts     # çŸ¥è¯†åº“ç›¸å…³
â”‚   â”œâ”€â”€ stores/          # Zustand çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ authStore.ts # è®¤è¯çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ chatStore.ts # èŠå¤©çŠ¶æ€
â”‚   â”‚   â””â”€â”€ kbStore.ts   # çŸ¥è¯†åº“çŠ¶æ€
â”‚   â”œâ”€â”€ services/        # API æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ api.ts       # API å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ auth.ts      # è®¤è¯ API
â”‚   â”‚   â”œâ”€â”€ chat.ts      # èŠå¤© API
â”‚   â”‚   â””â”€â”€ kb.ts        # çŸ¥è¯†åº“ API
â”‚   â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ constants.ts # å¸¸é‡å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ helpers.ts   # è¾…åŠ©å‡½æ•°
â”‚   â”‚   â””â”€â”€ validators.ts # éªŒè¯å‡½æ•°
â”‚   â””â”€â”€ types/           # TypeScript ç±»å‹
â”‚       â”œâ”€â”€ api.ts       # API ç±»å‹
â”‚       â”œâ”€â”€ chat.ts      # èŠå¤©ç±»å‹
â”‚       â””â”€â”€ kb.ts        # çŸ¥è¯†åº“ç±»å‹
â”œâ”€â”€ tests/               # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ public/              # é™æ€èµ„æº
â””â”€â”€ package.json
```

### åç«¯æ¶æ„
```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/             # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ __init__.py  # è·¯ç”±æ³¨å†Œ
â”‚   â”‚   â”œâ”€â”€ auth.py      # è®¤è¯ç›¸å…³ API
â”‚   â”‚   â”œâ”€â”€ chat.py      # èŠå¤©ç›¸å…³ API
â”‚   â”‚   â”œâ”€â”€ knowledge_base.py # çŸ¥è¯†åº“ç›¸å…³ API
â”‚   â”‚   â”œâ”€â”€ plugins.py   # æ’ä»¶ç›¸å…³ API
â”‚   â”‚   â”œâ”€â”€ smart_config.py # æ™ºèƒ½é…ç½® API
â”‚   â”‚   â”œâ”€â”€ enhanced_retrieval.py # å¢å¼ºæ£€ç´¢ API
â”‚   â”‚   â”œâ”€â”€ intelligent_retrieval.py # æ™ºèƒ½æ£€ç´¢ API
â”‚   â”‚   â””â”€â”€ v1/          # v1ç‰ˆæœ¬API
â”‚   â”‚       â”œâ”€â”€ admin.py # ç®¡ç†å‘˜API
â”‚   â”‚       â”œâ”€â”€ api_keys.py # APIå¯†é’¥ç®¡ç†
â”‚   â”‚       â”œâ”€â”€ external.py # å¤–éƒ¨API
â”‚   â”‚       â””â”€â”€ external_intelligent.py # å¤–éƒ¨æ™ºèƒ½æ£€ç´¢
â”‚   â”œâ”€â”€ core/            # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ config.py    # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ database.py  # æ•°æ®åº“é…ç½®
â”‚   â”‚   â”œâ”€â”€ auth.py      # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ deps.py      # ä¾èµ–æ³¨å…¥
â”‚   â”œâ”€â”€ models/          # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ user.py      # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ knowledge_base.py # çŸ¥è¯†åº“æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ chat.py      # èŠå¤©æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ api_key.py   # APIå¯†é’¥æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ admin.py     # ç®¡ç†å‘˜æ¨¡å‹
â”‚   â”‚   â””â”€â”€ plugin.py    # æ’ä»¶æ¨¡å‹
â”‚   â”œâ”€â”€ services/        # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ auth_service.py # è®¤è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ chat_service.py # èŠå¤©æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ knowledge_base_service.py # çŸ¥è¯†åº“æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ vector_service.py # å‘é‡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ admin_service.py # ç®¡ç†å‘˜æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ api_key_service.py # APIå¯†é’¥æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ intelligent_retrieval_service.py # æ™ºèƒ½æ£€ç´¢æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ enhanced_retrieval_pipeline.py # å¢å¼ºæ£€ç´¢æµæ°´çº¿
â”‚   â”‚   â”œâ”€â”€ intent_recognizer.py # æ„å›¾è¯†åˆ«å™¨
â”‚   â”‚   â”œâ”€â”€ strategy_scheduler.py # ç­–ç•¥è°ƒåº¦å™¨
â”‚   â”‚   â”œâ”€â”€ multi_query_expander.py # å¤šæŸ¥è¯¢æ‰©å±•å™¨
â”‚   â”‚   â”œâ”€â”€ hybrid_retriever.py # æ··åˆæ£€ç´¢å™¨
â”‚   â”‚   â”œâ”€â”€ reranker.py  # é‡æ’åºå™¨
â”‚   â”‚   â”œâ”€â”€ metadata_filter.py # å…ƒæ•°æ®è¿‡æ»¤å™¨
â”‚   â”‚   â””â”€â”€ smart_config.py # æ™ºèƒ½é…ç½®æœåŠ¡
â”‚   â”œâ”€â”€ schemas/         # æ•°æ®éªŒè¯
â”‚   â”‚   â”œâ”€â”€ user.py      # ç”¨æˆ·æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ knowledge_base.py # çŸ¥è¯†åº“æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ chat.py      # èŠå¤©æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ admin.py     # ç®¡ç†å‘˜æ¨¡å¼
â”‚   â”‚   â””â”€â”€ api_key.py   # APIå¯†é’¥æ¨¡å¼
â”‚   â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ security.py  # å®‰å…¨å·¥å…·
â”‚   â”‚   â”œâ”€â”€ file.py      # æ–‡ä»¶å¤„ç†
â”‚   â”‚   â””â”€â”€ helpers.py   # è¾…åŠ©å‡½æ•°
â”‚   â””â”€â”€ plugins/         # æ’ä»¶ç³»ç»Ÿ
â”‚       â”œâ”€â”€ __init__.py  # æ’ä»¶ç®¡ç†å™¨
â”‚       â””â”€â”€ base.py      # æ’ä»¶åŸºç±»
â”œâ”€â”€ alembic/             # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ tests/               # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ logs/                # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ uploads/             # ä¸Šä¼ æ–‡ä»¶
â””â”€â”€ requirements.txt     # ä¾èµ–æ–‡ä»¶
```

## ğŸ”§ å¼€å‘è§„èŒƒ

### ä»£ç è§„èŒƒ

#### å‰ç«¯è§„èŒƒ
- ä½¿ç”¨ TypeScriptï¼Œä¸¥æ ¼ç±»å‹æ£€æŸ¥
- ç»„ä»¶ä½¿ç”¨å‡½æ•°å¼ + Hooks
- çŠ¶æ€ç®¡ç†ä½¿ç”¨ Zustand
- æ ·å¼ä½¿ç”¨ Tailwind CSS
- æ–‡ä»¶å‘½åï¼šç»„ä»¶ PascalCaseï¼Œå·¥å…· camelCase
- å¿…é¡»å†™å•å…ƒæµ‹è¯•ï¼Œè¦†ç›–ç‡ > 80%

#### åç«¯è§„èŒƒ
- ä½¿ç”¨ FastAPI + SQLAlchemy
- éµå¾ª RESTful API è®¾è®¡
- ä½¿ç”¨ Pydantic è¿›è¡Œæ•°æ®éªŒè¯
- å¼‚æ­¥å¤„ç†ï¼Œä½¿ç”¨ async/await
- å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- å¿…é¡»å†™å•å…ƒæµ‹è¯•ï¼Œè¦†ç›–ç‡ > 80%

### Git è§„èŒƒ

#### åˆ†æ”¯ç®¡ç†
- `main`: ä¸»åˆ†æ”¯ï¼Œç”¨äºç”Ÿäº§ç¯å¢ƒ
- `develop`: å¼€å‘åˆ†æ”¯ï¼Œç”¨äºé›†æˆæµ‹è¯•
- `feature/*`: åŠŸèƒ½åˆ†æ”¯ï¼Œç”¨äºæ–°åŠŸèƒ½å¼€å‘
- `hotfix/*`: çƒ­ä¿®å¤åˆ†æ”¯ï¼Œç”¨äºç´§æ€¥ä¿®å¤

#### æäº¤è§„èŒƒ
```
<type>(<scope>): <subject>

<body>

<footer>
```

ç±»å‹è¯´æ˜ï¼š
- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼è°ƒæ•´
- `refactor`: ä»£ç é‡æ„
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

### æ•°æ®åº“è§„èŒƒ

#### å‘½åè§„èŒƒ
- è¡¨åï¼šå°å†™ï¼Œä¸‹åˆ’çº¿åˆ†éš”
- å­—æ®µåï¼šå°å†™ï¼Œä¸‹åˆ’çº¿åˆ†éš”
- ç´¢å¼•åï¼š`idx_è¡¨å_å­—æ®µå`
- å¤–é”®åï¼š`fk_è¡¨å_å­—æ®µå`

#### è¿ç§»è§„èŒƒ
- æ¯æ¬¡æ•°æ®åº“å˜æ›´éƒ½è¦åˆ›å»ºè¿ç§»æ–‡ä»¶
- è¿ç§»æ–‡ä»¶è¦æœ‰æ˜ç¡®çš„æè¿°
- ç”Ÿäº§ç¯å¢ƒè°¨æ…æ‰§è¡Œè¿ç§»

## ğŸ§ª æµ‹è¯•æŒ‡å—

### å‰ç«¯æµ‹è¯•
```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
npm run test

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# è¿è¡ŒE2Eæµ‹è¯•
npm run test:e2e
```

### åç«¯æµ‹è¯•
```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
pytest

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=app

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pytest tests/test_auth.py
```

### é›†æˆæµ‹è¯•
```bash
# è¿è¡ŒAPIé›†æˆæµ‹è¯•
pytest tests/integration/

# è¿è¡Œæ•°æ®åº“é›†æˆæµ‹è¯•
pytest tests/integration/test_database.py
```

## ğŸ” è°ƒè¯•æŒ‡å—

### å‰ç«¯è°ƒè¯•
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
# ä½¿ç”¨ React Developer Tools æ’ä»¶
```

### åç«¯è°ƒè¯•
```bash
# å¯åŠ¨è°ƒè¯•æ¨¡å¼
python -m uvicorn app.main:app --reload --log-level debug

# ä½¿ç”¨ VS Code è°ƒè¯•
# é…ç½® launch.json æ–‡ä»¶
```

### æ•°æ®åº“è°ƒè¯•
```bash
# è¿æ¥æ•°æ®åº“
psql -h localhost -U metabox -d metabox

# æŸ¥çœ‹è¡¨ç»“æ„
\d table_name

# æŸ¥çœ‹æ•°æ®
SELECT * FROM table_name LIMIT 10;
```

## ğŸ“¦ éƒ¨ç½²æŒ‡å—

### å¼€å‘ç¯å¢ƒéƒ¨ç½²
```bash
# ä½¿ç”¨ä¸€é”®éƒ¨ç½²è„šæœ¬
./scripts/dev_setup.sh setup
./scripts/dev_setup.sh start
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```bash
# æ„å»ºDockeré•œåƒ
docker-compose -f docker-compose.prod.yml build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡
docker-compose -f docker-compose.prod.yml up -d
```

## ğŸ”’ å®‰å…¨æŒ‡å—

### å¼€å‘å®‰å…¨
- æ‰€æœ‰ç”¨æˆ·è¾“å…¥éƒ½è¦éªŒè¯
- ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢SQLæ³¨å…¥
- å®ç°é€‚å½“çš„æƒé™æ§åˆ¶
- æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡

### ç”Ÿäº§å®‰å…¨
- ä½¿ç”¨HTTPS
- é…ç½®é˜²ç«å¢™
- å®šæœŸæ›´æ–°ä¾èµ–
- ç›‘æ§ç³»ç»Ÿæ—¥å¿—

## ğŸ“š å­¦ä¹ èµ„æº

### æŠ€æœ¯æ ˆ
- [FastAPI å®˜æ–¹æ–‡æ¡£](https://fastapi.tiangolo.com/)
- [React å®˜æ–¹æ–‡æ¡£](https://react.dev/)
- [TypeScript å®˜æ–¹æ–‡æ¡£](https://www.typescriptlang.org/)
- [Tailwind CSS å®˜æ–¹æ–‡æ¡£](https://tailwindcss.com/)

### æœ€ä½³å®è·µ
- [RESTful API è®¾è®¡æŒ‡å—](https://restfulapi.net/)
- [Python ä»£ç è§„èŒƒ](https://www.python.org/dev/peps/pep-0008/)
- [JavaScript ä»£ç è§„èŒƒ](https://github.com/airbnb/javascript)

## ğŸ¤ è´¡çŒ®æŒ‡å—

### è´¡çŒ®æµç¨‹
1. Fork é¡¹ç›®ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ï¼š`git checkout -b feature/AmazingFeature`
3. æäº¤æ›´æ”¹ï¼š`git commit -m 'Add some AmazingFeature'`
4. æ¨é€åˆ†æ”¯ï¼š`git push origin feature/AmazingFeature`
5. æäº¤ Pull Request

### ä»£ç å®¡æŸ¥
- æ‰€æœ‰ä»£ç å˜æ›´éƒ½éœ€è¦é€šè¿‡å®¡æŸ¥
- ç¡®ä¿æµ‹è¯•è¦†ç›–ç‡ä¸é™ä½
- éµå¾ªé¡¹ç›®ä»£ç è§„èŒƒ
- æ›´æ–°ç›¸å…³æ–‡æ¡£

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœæ‚¨åœ¨å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–å¸®åŠ©ï¼š

- ğŸ“§ é‚®ç®±ï¼šdev@metabox.ai
- ğŸ’¬ å¼€å‘è€…ç¾¤ï¼šæ‰«æäºŒç»´ç åŠ å…¥
- ğŸ› é—®é¢˜åé¦ˆï¼š[GitHub Issues](https://github.com/your-repo/metabox/issues)
- ğŸ“– æ–‡æ¡£ï¼š[é¡¹ç›®æ–‡æ¡£](https://docs.metabox.ai)

---

**å¼€å‘æŒ‡å—ç‰ˆæœ¬**: v1.0.0  
**æœ€åæ›´æ–°**: 2024å¹´12æœˆ 