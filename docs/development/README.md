# MetaBox å¼€å‘æŒ‡å—

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒæ­å»º

### å‰ç½®è¦æ±‚

- Node.js 18+
- Python 3.9+
- Docker & Docker Compose
- Git

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/your-repo/MetaBox.git
cd MetaBox
```

### 2. ç¯å¢ƒé…ç½®

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘ç¯å¢ƒå˜é‡
vim .env
```

### 3. å‰ç«¯å¼€å‘ç¯å¢ƒ

```bash
cd frontend

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# è¿è¡Œæµ‹è¯•
npm test

# ä»£ç æ£€æŸ¥
npm run lint
```

### 4. åç«¯å¼€å‘ç¯å¢ƒ

> **å¼ºåˆ¶è¦æ±‚ï¼šæ‰€æœ‰åç«¯ä¾èµ–å¿…é¡»å®‰è£…åœ¨ backend/venv è™šæ‹Ÿç¯å¢ƒç›®å½•ä¸‹ï¼Œä¸¥ç¦æ±¡æŸ“ç³»ç»Ÿç¯å¢ƒã€‚**

```bash
cd backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ– venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–ï¼ˆæ¨èå¼€å‘ç”¨ requirements-dev.txtï¼‰
pip install -r requirements-dev.txt

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# è¿è¡Œæµ‹è¯•
pytest

# ä»£ç æ ¼å¼åŒ–
black .
isort .
```

### 5. æ•°æ®åº“è®¾ç½®

```bash
# å¯åŠ¨æ•°æ®åº“æœåŠ¡
docker-compose up postgres qdrant -d

# è¿è¡Œæ•°æ®åº“è¿ç§»
cd backend
alembic upgrade head
```

## ğŸ“ é¡¹ç›®ç»“æ„è¯´æ˜

### å‰ç«¯ç»“æ„

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/          # å¯å¤ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ui/             # åŸºç¡€ UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ chat/           # èŠå¤©ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatSidebar.tsx      # å·¦ä¾§ä¼šè¯åˆ—è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatMessageList.tsx  # æ¶ˆæ¯åˆ—è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatMessage.tsx      # å•æ¡æ¶ˆæ¯æ°”æ³¡
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatInputBar.tsx     # åº•éƒ¨è¾“å…¥åŒº
â”‚   â”‚   â”‚   â”œâ”€â”€ ModelSelector.tsx    # æ¨¡å‹é€‰æ‹©å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ KnowledgeBaseSelector.tsx # çŸ¥è¯†åº“é€‰æ‹©å™¨
â”‚   â”‚   â”‚   â””â”€â”€ ChatHeader.tsx       # èŠå¤©å¤´éƒ¨
â”‚   â”‚   â”œâ”€â”€ kb/             # çŸ¥è¯†åº“ç›¸å…³ç»„ä»¶
â”‚   â”‚   â””â”€â”€ common/         # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ pages/              # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Home.tsx        # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ Chat.tsx        # èŠå¤©é¡µé¢
â”‚   â”‚   â”œâ”€â”€ KnowledgeBase.tsx # çŸ¥è¯†åº“é¡µé¢
â”‚   â”‚   â””â”€â”€ Settings.tsx    # è®¾ç½®é¡µé¢
â”‚   â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â”œâ”€â”€ useAuth.ts      # è®¤è¯ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ useChat.ts      # èŠå¤©ç›¸å…³
â”‚   â”‚   â””â”€â”€ useKB.ts        # çŸ¥è¯†åº“ç›¸å…³
â”‚   â”œâ”€â”€ stores/             # Zustand çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ authStore.ts    # è®¤è¯çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ chatStore.ts    # èŠå¤©çŠ¶æ€
â”‚   â”‚   â””â”€â”€ kbStore.ts      # çŸ¥è¯†åº“çŠ¶æ€
â”‚   â”œâ”€â”€ services/           # API æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ api.ts          # API å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ auth.ts         # è®¤è¯ API
â”‚   â”‚   â”œâ”€â”€ chat.ts         # èŠå¤© API
â”‚   â”‚   â””â”€â”€ kb.ts           # çŸ¥è¯†åº“ API
â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ constants.ts    # å¸¸é‡å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ helpers.ts      # è¾…åŠ©å‡½æ•°
â”‚   â”‚   â””â”€â”€ validators.ts   # éªŒè¯å‡½æ•°
â”‚   â””â”€â”€ types/              # TypeScript ç±»å‹
â”‚       â”œâ”€â”€ api.ts          # API ç±»å‹
â”‚       â”œâ”€â”€ chat.ts         # èŠå¤©ç±»å‹
â”‚       â””â”€â”€ kb.ts           # çŸ¥è¯†åº“ç±»å‹
â”œâ”€â”€ tests/                  # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ public/                 # é™æ€èµ„æº
â””â”€â”€ package.json
```

### åç«¯ç»“æ„

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/                # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ auth.py         # è®¤è¯ç›¸å…³ API
â”‚   â”‚   â”œâ”€â”€ chat.py         # èŠå¤©ç›¸å…³ API
â”‚   â”‚   â”œâ”€â”€ kb.py           # çŸ¥è¯†åº“ç›¸å…³ API
â”‚   â”‚   â””â”€â”€ plugins.py      # æ’ä»¶ç›¸å…³ API
â”‚   â”œâ”€â”€ core/               # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py       # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ database.py     # æ•°æ®åº“é…ç½®
â”‚   â”‚   â”œâ”€â”€ security.py     # å®‰å…¨ç›¸å…³
â”‚   â”‚   â””â”€â”€ dependencies.py # ä¾èµ–æ³¨å…¥
â”‚   â”œâ”€â”€ models/             # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ user.py         # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ kb.py           # çŸ¥è¯†åº“æ¨¡å‹
â”‚   â”‚   â””â”€â”€ chat.py         # èŠå¤©æ¨¡å‹
â”‚   â”œâ”€â”€ services/           # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ auth_service.py # è®¤è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ chat_service.py # èŠå¤©æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ kb_service.py   # çŸ¥è¯†åº“æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ rag_service.py  # RAG æœåŠ¡
â”‚   â”‚   â””â”€â”€ vector_service.py # å‘é‡æœåŠ¡
â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ file_utils.py   # æ–‡ä»¶å¤„ç†
â”‚   â”‚   â”œâ”€â”€ text_utils.py   # æ–‡æœ¬å¤„ç†
â”‚   â”‚   â””â”€â”€ image_utils.py  # å›¾åƒå¤„ç†
â”‚   â””â”€â”€ main.py             # åº”ç”¨å…¥å£
â”œâ”€â”€ tests/                  # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ alembic/                # æ•°æ®åº“è¿ç§»
â””â”€â”€ requirements.txt
```

## ğŸ”§ å¼€å‘è§„èŒƒ

### ä»£ç é£æ ¼

#### å‰ç«¯ (TypeScript/React)

- ä½¿ç”¨å‡½æ•°ç»„ä»¶ + Hooks
- ç»„ä»¶åä½¿ç”¨ PascalCase
- æ–‡ä»¶åä½¿ç”¨ PascalCase (ç»„ä»¶) æˆ– camelCase (å·¥å…·)
- ä½¿ç”¨ TypeScript ä¸¥æ ¼æ¨¡å¼
- å¿…é¡»ä¸ºç»„ä»¶å®šä¹‰ Props æ¥å£

```typescript
// âœ… æ­£ç¡®ç¤ºä¾‹
interface ChatMessageProps {
  message: Message;
  onDelete?: (id: string) => void;
}

const ChatMessage: React.FC<ChatMessageProps> = ({ message, onDelete }) => {
  return <div>{message.content}</div>;
};
```

#### åç«¯ (Python/FastAPI)

- ä½¿ç”¨ç±»å‹æ³¨è§£
- éµå¾ª PEP 8 è§„èŒƒ
- ä½¿ç”¨ Pydantic è¿›è¡Œæ•°æ®éªŒè¯
- å¼‚æ­¥å‡½æ•°ä½¿ç”¨ async/await

```python
# âœ… æ­£ç¡®ç¤ºä¾‹
from pydantic import BaseModel
from typing import List, Optional

class ChatRequest(BaseModel):
    message: str
    kb_ids: List[str]
    history: Optional[List[dict]] = None

async def chat_endpoint(request: ChatRequest) -> dict:
    result = await chat_service.process(request)
    return {"answer": result}
```

## ğŸ’¬ Chat ç•Œé¢è®¾è®¡è§„èŒƒ

### è®¾è®¡ç›®æ ‡
å¯¹æ ‡ ChatGPT çš„ç°ä»£åŒ–å¯¹è¯ä½“éªŒï¼Œæ”¯æŒçŸ¥è¯†åº“å’Œå¤§æ¨¡å‹çµæ´»åˆ‡æ¢ï¼Œç•Œé¢ç¾è§‚ã€äº¤äº’æµç•…ï¼Œæå‡ä¸“ä¸šæ„Ÿå’Œæ˜“ç”¨æ€§ã€‚

### é¡µé¢å¸ƒå±€ç»“æ„

#### 1. æ•´ä½“å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   é¡¶éƒ¨å¯¼èˆªæ  (Layout)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚             â”‚                                               â”‚
â”‚   å·¦ä¾§æ     â”‚                ä¸»å¯¹è¯åŒº                        â”‚
â”‚  (Sidebar)  â”‚                                               â”‚
â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚             â”‚  â”‚           èŠå¤©å¤´éƒ¨ (Header)              â”‚  â”‚
â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                                               â”‚
â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚             â”‚  â”‚          æ¶ˆæ¯åˆ—è¡¨ (MessageList)          â”‚  â”‚
â”‚             â”‚  â”‚                                           â”‚  â”‚
â”‚             â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚             â”‚  â”‚  â”‚        ç”¨æˆ·æ¶ˆæ¯æ°”æ³¡                  â”‚  â”‚
â”‚             â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚  â”‚                                           â”‚  â”‚
â”‚             â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚             â”‚  â”‚  â”‚        AI æ¶ˆæ¯æ°”æ³¡                   â”‚  â”‚
â”‚             â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                                               â”‚
â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚             â”‚  â”‚          è¾“å…¥åŒºåŸŸ (InputBar)             â”‚  â”‚
â”‚             â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚             â”‚  â”‚  â”‚  çŸ¥è¯†åº“é€‰æ‹© â”‚ æ¨¡å‹é€‰æ‹© â”‚ å‘é€æŒ‰é’®    â”‚  â”‚
â”‚             â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚             â”‚  â”‚  â”‚           å¤šè¡Œè¾“å…¥æ¡†                 â”‚  â”‚
â”‚             â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. å·¦ä¾§æ  (ChatSidebar)
- **åŠŸèƒ½**ï¼šä¼šè¯åˆ—è¡¨ç®¡ç†
- **ç»„ä»¶**ï¼š
  - æ–°å»ºä¼šè¯æŒ‰é’®
  - ä¼šè¯åˆ—è¡¨ï¼ˆæ”¯æŒæœç´¢ã€é‡å‘½åã€åˆ é™¤ï¼‰
  - ä¼šè¯åˆ†ç»„ï¼ˆæœ€è¿‘ã€æ”¶è—ç­‰ï¼‰
- **äº¤äº’**ï¼š
  - ç‚¹å‡»åˆ‡æ¢ä¼šè¯
  - å³é”®èœå•ï¼ˆé‡å‘½åã€åˆ é™¤ã€å¯¼å‡ºï¼‰
  - æ‹–æ‹½æ’åº

#### 3. èŠå¤©å¤´éƒ¨ (ChatHeader)
- **åŠŸèƒ½**ï¼šå½“å‰ä¼šè¯ä¿¡æ¯ä¸æ“ä½œ
- **ç»„ä»¶**ï¼š
  - ä¼šè¯æ ‡é¢˜ï¼ˆå¯ç¼–è¾‘ï¼‰
  - æ“ä½œæŒ‰é’®ï¼ˆæ¸…ç©ºã€å¯¼å‡ºã€è®¾ç½®ï¼‰
  - å½“å‰æ¨¡å‹/çŸ¥è¯†åº“çŠ¶æ€
- **äº¤äº’**ï¼š
  - ç‚¹å‡»æ ‡é¢˜ç¼–è¾‘
  - æ‚¬åœæ˜¾ç¤ºæ“ä½œæŒ‰é’®

#### 4. æ¶ˆæ¯åˆ—è¡¨ (ChatMessageList)
- **åŠŸèƒ½**ï¼šæ¶ˆæ¯æµå±•ç¤º
- **ç»„ä»¶**ï¼š
  - æ¶ˆæ¯æ°”æ³¡ï¼ˆç”¨æˆ·/AIï¼‰
  - æ¶ˆæ¯çŠ¶æ€ï¼ˆå‘é€ä¸­ã€æˆåŠŸã€å¤±è´¥ï¼‰
  - æ¶ˆæ¯æ“ä½œï¼ˆå¤åˆ¶ã€é‡æ–°ç”Ÿæˆã€åé¦ˆï¼‰
- **äº¤äº’**ï¼š
  - è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
  - æµå¼å“åº”åŠ¨ç”»
  - æ¶ˆæ¯å¼•ç”¨ä¸è¿½æº¯

#### 5. è¾“å…¥åŒºåŸŸ (ChatInputBar)
- **åŠŸèƒ½**ï¼šæ¶ˆæ¯è¾“å…¥ä¸å‘é€
- **ç»„ä»¶**ï¼š
  - çŸ¥è¯†åº“é€‰æ‹©ä¸‹æ‹‰æ¡†
  - æ¨¡å‹é€‰æ‹©ä¸‹æ‹‰æ¡†
  - å¤šè¡Œè¾“å…¥æ¡†
  - å‘é€æŒ‰é’®
  - æ–‡ä»¶ä¸Šä¼ æŒ‰é’®
  - é«˜çº§è®¾ç½®æŠ˜å é¢æ¿
- **äº¤äº’**ï¼š
  - Enter å‘é€ï¼ŒShift+Enter æ¢è¡Œ
  - æ‹–æ‹½ä¸Šä¼ æ–‡ä»¶
  - è¾“å…¥æ¡†è‡ªé€‚åº”é«˜åº¦

### ç»„ä»¶è®¾è®¡è§„èŒƒ

#### 1. ChatSidebar ç»„ä»¶
```typescript
interface ChatSidebarProps {
  sessions: Session[];
  currentSessionId: string;
  onSessionSelect: (sessionId: string) => void;
  onNewSession: () => void;
  onSessionDelete: (sessionId: string) => void;
  onSessionRename: (sessionId: string, name: string) => void;
}
```

#### 2. ChatMessage ç»„ä»¶
```typescript
interface ChatMessageProps {
  message: Message;
  isStreaming?: boolean;
  onCopy?: (content: string) => void;
  onRegenerate?: () => void;
  onFeedback?: (type: 'like' | 'dislike') => void;
}
```

#### 3. ChatInputBar ç»„ä»¶
```typescript
interface ChatInputBarProps {
  onSend: (message: string, options: SendOptions) => void;
  onFileUpload: (files: File[]) => void;
  knowledgeBases: KnowledgeBase[];
  models: Model[];
  selectedKnowledgeBase: string;
  selectedModel: string;
  onKnowledgeBaseChange: (kbId: string) => void;
  onModelChange: (modelId: string) => void;
}
```

### çŠ¶æ€ç®¡ç†è®¾è®¡

#### 1. Chat Store (Zustand)
```typescript
interface ChatStore {
  // ä¼šè¯ç®¡ç†
  sessions: Session[];
  currentSessionId: string;
  
  // æ¶ˆæ¯ç®¡ç†
  messages: Record<string, Message[]>;
  streamingMessageId: string | null;
  
  // é…ç½®ç®¡ç†
  selectedKnowledgeBase: string;
  selectedModel: string;
  chatSettings: ChatSettings;
  
  // æ“ä½œ
  createSession: () => void;
  switchSession: (sessionId: string) => void;
  sendMessage: (content: string) => Promise<void>;
  updateSettings: (settings: Partial<ChatSettings>) => void;
}
```

### äº¤äº’è§„èŒƒ

#### 1. å¿«æ·é”®
- `Enter`: å‘é€æ¶ˆæ¯
- `Shift + Enter`: æ¢è¡Œ
- `Ctrl/Cmd + K`: æ–°å»ºä¼šè¯
- `Ctrl/Cmd + L`: æ¸…ç©ºå½“å‰ä¼šè¯
- `Ctrl/Cmd + S`: å¯¼å‡ºä¼šè¯

#### 2. æ¶ˆæ¯åé¦ˆ
- æ¯æ¡ AI æ¶ˆæ¯ä¸‹æ–¹æ˜¾ç¤º ğŸ‘/ğŸ‘ æŒ‰é’®
- ç‚¹å‡»åè®°å½•åé¦ˆï¼Œå¯æ’¤é”€
- åé¦ˆæ•°æ®ç”¨äºæ¨¡å‹ä¼˜åŒ–

#### 3. æ–‡ä»¶ä¸Šä¼ 
- æ”¯æŒæ‹–æ‹½åˆ°è¾“å…¥æ¡†
- æ”¯æŒç‚¹å‡»ä¸Šä¼ æŒ‰é’®
- æ”¯æŒå›¾ç‰‡é¢„è§ˆ
- æ–‡ä»¶å¤§å°é™åˆ¶ï¼š10MB

#### 4. æµå¼å“åº”
- å®æ—¶æ˜¾ç¤º AI å›å¤
- æ‰“å­—æœºæ•ˆæœ
- æ”¯æŒä¸­æ–­å“åº”
- å“åº”å®Œæˆåæ˜¾ç¤ºæ“ä½œæŒ‰é’®

### è§†è§‰è®¾è®¡è§„èŒƒ

#### 1. é…è‰²æ–¹æ¡ˆ
- **ä¸»è‰²è°ƒ**: #10a37f (ChatGPT ç»¿)
- **èƒŒæ™¯è‰²**: #ffffff (ä¸»èƒŒæ™¯), #f7f7f8 (ä¾§è¾¹æ )
- **æ–‡å­—è‰²**: #374151 (ä¸»è¦æ–‡å­—), #6b7280 (æ¬¡è¦æ–‡å­—)
- **è¾¹æ¡†è‰²**: #e5e7eb
- **å¼ºè°ƒè‰²**: #3b82f6 (é“¾æ¥), #ef4444 (é”™è¯¯)

#### 2. å­—ä½“è§„èŒƒ
- **ä¸»å­—ä½“**: Inter, -apple-system, BlinkMacSystemFont
- **ä»£ç å­—ä½“**: 'Fira Code', 'Monaco', 'Consolas'
- **å­—å·**: 14px (æ­£æ–‡), 16px (æ ‡é¢˜), 12px (è¾…åŠ©æ–‡å­—)

#### 3. é—´è·è§„èŒƒ
- **ç»„ä»¶é—´è·**: 16px, 24px, 32px
- **å†…è¾¹è·**: 12px, 16px, 20px
- **åœ†è§’**: 8px (å¡ç‰‡), 6px (æŒ‰é’®), 4px (è¾“å…¥æ¡†)

#### 4. é˜´å½±è§„èŒƒ
- **å¡ç‰‡é˜´å½±**: 0 1px 3px 0 rgba(0, 0, 0, 0.1)
- **æ‚¬æµ®é˜´å½±**: 0 4px 6px -1px rgba(0, 0, 0, 0.1)
- **è¾“å…¥æ¡†é˜´å½±**: 0 0 0 3px rgba(16, 163, 127, 0.1)

### å“åº”å¼è®¾è®¡

#### 1. æ–­ç‚¹è®¾ç½®
- **ç§»åŠ¨ç«¯**: < 768px
- **å¹³æ¿**: 768px - 1024px
- **æ¡Œé¢**: > 1024px

#### 2. ç§»åŠ¨ç«¯é€‚é…
- ä¾§è¾¹æ å¯æŠ˜å 
- è¾“å…¥æ¡†å›ºå®šåœ¨åº•éƒ¨
- æ¶ˆæ¯æ°”æ³¡å…¨å®½æ˜¾ç¤º
- è§¦æ‘¸å‹å¥½çš„æŒ‰é’®å°ºå¯¸

### æ€§èƒ½ä¼˜åŒ–

#### 1. æ¶ˆæ¯æ¸²æŸ“
- è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§é‡æ¶ˆæ¯æ—¶ï¼‰
- æ¶ˆæ¯æ‡’åŠ è½½
- å›¾ç‰‡æ‡’åŠ è½½

#### 2. çŠ¶æ€ç®¡ç†
- æ¶ˆæ¯åˆ†é¡µåŠ è½½
- ä¼šè¯åˆ—è¡¨ç¼“å­˜
- é˜²æŠ–æœç´¢

#### 3. ç½‘ç»œä¼˜åŒ–
- æµå¼å“åº”
- è¯·æ±‚å–æ¶ˆ
- é”™è¯¯é‡è¯•
- ç¦»çº¿æ”¯æŒ

### æµ‹è¯•è§„èŒƒ

#### 1. å•å…ƒæµ‹è¯•
- ç»„ä»¶æ¸²æŸ“æµ‹è¯•
- ç”¨æˆ·äº¤äº’æµ‹è¯•
- çŠ¶æ€ç®¡ç†æµ‹è¯•

#### 2. é›†æˆæµ‹è¯•
- æ¶ˆæ¯å‘é€æµç¨‹
- ä¼šè¯ç®¡ç†æµç¨‹
- æ–‡ä»¶ä¸Šä¼ æµç¨‹

#### 3. E2E æµ‹è¯•
- å®Œæ•´å¯¹è¯æµç¨‹
- å¤šä¼šè¯åˆ‡æ¢
- å“åº”å¼å¸ƒå±€

## ğŸš€ éƒ¨ç½²æµç¨‹

### å¼€å‘ç¯å¢ƒéƒ¨ç½²

```bash
# ä½¿ç”¨ Docker Compose
docker-compose up -d

# æˆ–ä½¿ç”¨éƒ¨ç½²è„šæœ¬
./scripts/deploy.sh dev
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

```bash
# ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
./scripts/deploy.sh prod
```

## ğŸ“š å¸¸ç”¨å‘½ä»¤

### å‰ç«¯

```bash
# å¼€å‘
npm run dev

# æ„å»º
npm run build

# æµ‹è¯•
npm test
npm run test:coverage

# ä»£ç æ£€æŸ¥
npm run lint
npm run lint:fix
```

### åç«¯

```bash
# å¼€å‘
uvicorn app.main:app --reload

# æµ‹è¯•
pytest
pytest --cov=app

# ä»£ç æ ¼å¼åŒ–
black .
isort .

# ç±»å‹æ£€æŸ¥
mypy app/
```

### æ•°æ®åº“

```bash
# åˆ›å»ºè¿ç§»
alembic revision --autogenerate -m "æè¿°"

# åº”ç”¨è¿ç§»
alembic upgrade head

# å›æ»šè¿ç§»
alembic downgrade -1
```

## ğŸ› å¸¸è§é—®é¢˜

### 1. å‰ç«¯æ„å»ºå¤±è´¥

```bash
# æ¸…ç†ç¼“å­˜
rm -rf node_modules package-lock.json
npm install
```

### 2. åç«¯ä¾èµ–å†²çª

```bash
# é‡æ–°åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
rm -rf venv
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### 3. æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥æ•°æ®åº“æœåŠ¡çŠ¶æ€
docker-compose ps

# é‡å¯æ•°æ®åº“æœåŠ¡
docker-compose restart postgres
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- ğŸ“§ é‚®ç®±ï¼šdev@metabox.com
- ğŸ’¬ è®¨è®ºï¼š[GitHub Discussions](https://github.com/your-repo/MetaBox/discussions)
- ğŸ› é—®é¢˜åé¦ˆï¼š[GitHub Issues](https://github.com/your-repo/MetaBox/issues) 

## æ™ºèƒ½é…ç½®ä¸å‰åç«¯è”è°ƒè¯´æ˜

### 1. æ™ºèƒ½é…ç½®APIå¯¹æ¥
- è·¯å¾„ï¼š`POST /kb/smart-config`
- å‚æ•°ï¼šcontentï¼ˆæ–‡æ¡£å†…å®¹ï¼‰ï¼Œuser_preferencesï¼ˆå¯é€‰ï¼Œç”¨æˆ·è‡ªå®šä¹‰å‚æ•°ï¼‰
- è¿”å›ï¼šæ¨èå‚æ•°ã€ç±»å‹ã€ç½®ä¿¡åº¦ã€éªŒè¯ç»“æœ

### 2. å‰ç«¯å‚æ•°æ˜ å°„
- æ¨èå‚æ•°ä¸å‰ç«¯è¡¨å•å­—æ®µä¸€ä¸€å¯¹åº”
- æ”¯æŒé«˜çº§å‚æ•°ï¼ˆåˆ†éš”ç¬¦ã€headerå±‚çº§ã€è¯­ä¹‰é˜ˆå€¼ç­‰ï¼‰
- å‚æ•°å˜æ›´åå¯å®æ—¶è¯·æ±‚APIæ ¡éªŒä¸é¢„è§ˆ

### 3. é…ç½®é¢„è§ˆä¸æ€§èƒ½è¯„ä¼°
- è·¯å¾„ï¼š`POST /kb/smart-config/preview`
- è¿”å›ï¼šåˆ†å—é¢„è§ˆã€æ€§èƒ½æŒ‡æ ‡ã€è´¨é‡è¯„åˆ†
- å‰ç«¯å±•ç¤ºï¼šåˆ†å—å†…å®¹ã€åˆ†å—æ•°ã€å¹³å‡å¤§å°ã€å¤„ç†æ—¶é—´ã€å†…å­˜ã€å­˜å‚¨ã€è¯„åˆ†

### 4. é…ç½®æ¨¡æ¿ç®¡ç†
- æ”¯æŒä¿å­˜ã€åº”ç”¨ã€æ›´æ–°ã€åˆ é™¤é…ç½®æ¨¡æ¿
- è·¯å¾„ï¼š`/kb/smart-config/template`ï¼ˆPOST/GET/PUT/DELETEï¼‰
- æ‰¹é‡åº”ç”¨ï¼š`/kb/smart-config/batch`

### 5. Embeddingè·¯ç”±ä¸æ··åˆåˆ†å—
- embedding_modelå‚æ•°å¯é€‰ï¼Œæ”¯æŒå¤šæ¨¡å‹
- use_parent_child/parent_chunk_size/child_chunk_sizeå‚æ•°æ”¯æŒæ··åˆåˆ†å—
- å‰ç«¯å¯è§†åŒ–çˆ¶å­ç»“æ„

---

å¦‚éœ€è”è°ƒæˆ–æ‰©å±•æ–°åŠŸèƒ½ï¼Œè¯·å‚è€ƒdocs/rag_optimization_tech.mdæŠ€æœ¯æ–¹æ¡ˆã€‚ 